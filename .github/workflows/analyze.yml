name: Analyze with SonarCloud

on:
    push:
        branches:
            - master

jobs:
    build:
        name: Build and Analyze
        runs-on: ubuntu-latest
        steps:
            - name: Fetch repository
              uses: actions/checkout@v1
            - name: Setup .NET Core
              uses: actions/setup-dotnet@v1
              with:
                  dotnet-version: 3.0.0
            - name: Build with dotnet
              run: dotnet build Solution/Solution.sln --configuration Release
            - name: Archive code coverage results
              uses: actions/upload-artifact@v1
              with:
                  name: code-coverage-report
                  path: bin

    sonarCloudTrigger:
        needs: build
        name: SonarCloud Trigger
        runs-on: ubuntu-latest
        steps:
            - name: Clone Repository
              uses: actions/checkout@master
            - name: Download code coverage results
              uses: actions/download-artifact@v1
              with:
                  name: code-coverage-report
                  path: bin
            - name: Analyze with SonarCloud
              uses: sonarsource/sonarcloud-github-action@master
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                  SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
